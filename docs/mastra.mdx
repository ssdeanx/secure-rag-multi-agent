---
title: Mastra Backend — Multi-Domain AI Orchestration
summary: Architecture, configuration, API reference, security model, and operational guidance for the Mastra backend powering the Multi-Domain AI Orchestration Platform.
---

import {
    Card,
    CardHeader,
    CardTitle,
    CardContent,
    Tabs,
    TabsList,
    TabsTrigger,
    TabsContent,
    Badge,
    Button,
    Alert,
    AlertTitle,
    AlertDescription,
    Separator,
    Mermaid,
    Shield,
    Database,
    Users,
    Zap,
    Brain,
    FileText,
    CheckCircle,
    Typography,
    Box,
    AlertTriangle,
} from '@/components/docs/mdx-bridge.joy'

<!-- Title is set in frontmatter (avoid duplicate H1) -->

<!-- toc -->

<Card>
    <CardHeader>
        <CardTitle>Overview</CardTitle>
    </CardHeader>
    <CardContent>
        This document describes the Mastra backend that powers the Multi-Domain AI Orchestration Platform
        in this repository. It covers architecture, security, API endpoints, deployment notes, and quick
        operational examples for 27 specialized agents across 5 capability domains.
    </CardContent>
</Card>

<Separator sx={{ my: 2 }} />

## Architecture

<Tabs defaultValue="system">
  <TabsList>
    <TabsTrigger value="system">System</TabsTrigger>
    <TabsTrigger value="agents">Agents</TabsTrigger>
    <TabsTrigger value="storage">Storage</TabsTrigger>
    <TabsTrigger value="observability">Observability</TabsTrigger>
  </TabsList>

  <TabsContent value="system">
    <Typography sx={{ fontSize: '1.125rem', fontWeight: 'bold', mb: 2 }}>High-level Components</Typography>
    <Box component="ul" sx={{ ml: 3, '& li': { mb: 1 } }}>
      <li><strong>Mastra Server</strong> — Orchestrates agents, enforces policies, and provides an API surface for the frontend and CI systems.</li>
      <li><strong>Agents</strong> — 27 specialized agents for retrieval, research, content generation, evaluation, and more across 5 capability domains.</li>
      <li><strong>Vector Store</strong> — PostgreSQL with PgVector for high-performance similarity search with 1568-dimension embeddings.</li>
      <li><strong>Storage</strong> — PostgreSQL for metadata and conversation storage with PgVector support.</li>
      <li><strong>Auth & Session</strong> — Mastra JWT authentication with role-based access control.</li>
      <li><strong>Memory</strong> — Advanced conversation memory with thread management and context persistence.</li>
    </Box>
    <Typography sx={{ fontSize: '1rem', fontWeight: 'bold', mt: 3, mb: 2 }}>System Architecture Diagram</Typography>
    <Box sx={{ bgcolor: 'background.surface', p: 3, borderRadius: 1, border: '1px solid', borderColor: 'divider' }}>
      <Mermaid chart={`graph TB
        A[Next.js Frontend] --> B[API Routes]
        B --> C[Mastra Server]
        C --> D[Agent Orchestrator]
        D --> E[27 Specialized Agents]
        E --> F[PgVector DB]
        E --> G[PostgreSQL Storage]
        C --> H[Mastra Auth]
        C --> I[Memory System]
        F --> J[1568D Embeddings]
        G --> K[Thread Management]
        classDef frontend fill:#e1f5fe,stroke:#01579b,stroke-width:2px
        classDef backend fill:#fff3e0,stroke:#e65100,stroke-width:2px
        classDef storage fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
        classDef ai fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
        class A,B frontend
        class C,D,H,I backend
        class F,G,J,K storage
        class E ai
`} />
    </Box>

  </TabsContent>

  <TabsContent value="agents">
    <Typography sx={{ fontSize: '1.125rem', fontWeight: 'bold', mb: 2 }}>Agents & Networks (27+ total)</Typography>
    <Typography sx={{ mb: 2 }}>27+ specialized agents and 3 agent networks configured across 5 capability domains in <Typography component="code" sx={{ fontSize: '0.875rem' }}>src/mastra/agents/</Typography> and orchestrated through workflows in <Typography component="code" sx={{ fontSize: '0.875rem' }}>src/mastra/workflows/</Typography>.</Typography>
    <Box sx={{ display: 'grid', gridTemplateColumns: { xs: '1fr', md: 'repeat(2, 1fr)' }, gap: 3, mb: 3 }}>
      <Card variant="outlined">
        <CardHeader>
          <CardTitle sx={{ fontSize: '0.875rem' }}>Governed RAG Agents (6 core)</CardTitle>
        </CardHeader>
        <CardContent>
          <Box component="ul" sx={{ m: 0, pl: 2, '& li': { mb: 1, fontSize: '0.875rem' } }}>
            <li><Badge variant="soft" sx={{ mr: 1 }}>identity</Badge>Authentication & user identity</li>
            <li><Badge variant="soft" sx={{ mr: 1 }}>policy</Badge>Access control & policy enforcement</li>
            <li><Badge variant="soft" sx={{ mr: 1 }}>retrieve</Badge>Vector search with security filters</li>
            <li><Badge variant="soft" sx={{ mr: 1 }}>rerank</Badge>Relevance scoring and reordering</li>
            <li><Badge variant="soft" sx={{ mr: 1 }}>answerer</Badge>Response generation with citations</li>
            <li><Badge variant="soft" sx={{ mr: 1 }}>verifier</Badge>Security compliance auditing</li>
          </Box>
        </CardContent>
      </Card>
      <Card variant="outlined">
        <CardHeader>
          <CardTitle sx={{ fontSize: '0.875rem' }}>Domain Agents (21+ specialized)</CardTitle>
        </CardHeader>
        <CardContent>
          <Box component="ul" sx={{ m: 0, pl: 2, '& li': { mb: 1, fontSize: '0.875rem' } }}>
            <li><Badge variant="soft" sx={{ mr: 1 }}>research</Badge>Multi-source research & analysis</li>
            <li><Badge variant="soft" sx={{ mr: 1 }}>copywriter</Badge>Content creation & optimization</li>
            <li><Badge variant="soft" sx={{ mr: 1 }}>editor</Badge>Content editing & refinement</li>
            <li><Badge variant="soft" sx={{ mr: 1 }}>cryptoAnalysis</Badge>Cryptocurrency market analysis</li>
            <li><Badge variant="soft" sx={{ mr: 1 }}>stockAnalysis</Badge>Stock market analysis</li>
            <li><Badge variant="soft" sx={{ mr: 1 }}>productRoadmap</Badge>Product planning & roadmapping</li>
            <li><Badge variant="soft" sx={{ mr: 1 }}>assistant</Badge>General AI assistance</li>
            <li><Badge variant="soft" sx={{ mr: 1 }}>evaluation</Badge>Quality assessment & scoring</li>
          </Box>
        </CardContent>
      </Card>
    </Box>
    <Typography sx={{ fontSize: '1rem', fontWeight: 'bold', mt: 3, mb: 2 }}>Agent Networks (3 orchestrated systems)</Typography>
    <Box sx={{ display: 'grid', gridTemplateColumns: { xs: '1fr', md: 'repeat(3, 1fr)' }, gap: 2, mb: 3 }}>
      <Card variant="soft">
        <CardHeader sx={{ pb: 1 }}>
          <CardTitle sx={{ fontSize: '0.9rem' }}>research-content-network</CardTitle>
        </CardHeader>
        <CardContent sx={{ pt: 0 }}>
          <Typography level="body-xs">Research → Content Generation → Editing</Typography>
        </CardContent>
      </Card>
      <Card variant="soft">
        <CardHeader sx={{ pb: 1 }}>
          <CardTitle sx={{ fontSize: '0.9rem' }}>financial-team-network</CardTitle>
        </CardHeader>
        <CardContent sx={{ pt: 0 }}>
          <Typography level="body-xs">Crypto + Stock Analysis + Market Education</Typography>
        </CardContent>
      </Card>
      <Card variant="soft">
        <CardHeader sx={{ pb: 1 }}>
          <CardTitle sx={{ fontSize: '0.9rem' }}>governed-rag-network</CardTitle>
        </CardHeader>
        <CardContent sx={{ pt: 0 }}>
          <Typography level="body-xs">Secure RAG pipeline orchestration</Typography>
        </CardContent>
      </Card>
    </Box>
    <Typography sx={{ fontSize: '1rem', fontWeight: 'bold', mt: 3, mb: 2 }}>Real Agent Example: Retrieve Agent</Typography>
    <Box sx={{ bgcolor: 'background.surface', p: 3, borderRadius: 1, fontSize: '0.875rem', fontFamily: 'monospace', overflowX: 'auto', mb: 2 }}>
      <pre style={{ margin: 0, whiteSpace: 'pre-wrap' }}>
{`import { Agent } from "@mastra/core";
import { google } from "@ai-sdk/google";
import { vectorQueryTool } from "../tools/vector-query.tool";
import { pgMemory } from '../config/pg-storage';

const memory = createResearchMemory();

export const retrieveAgent = new Agent({
  id: "retrieve",
  name: "retrieve",
  model: google('gemini-2.5-flash-lite'),
  description: "A document retrieval agent that retrieves relevant documents based on a user's question and access level.",
  instructions: \`You are a document retrieval agent. You MUST call vectorQueryTool EXACTLY ONCE and ONLY return its results.

**MANDATORY STEPS:**

1.  Parse input JSON for 'question' and 'access' fields
2.  Call vectorQueryTool EXACTLY ONCE with these exact parameters:
    - question: the question from input
    - allowTags: from access.allowTags array
    - maxClassification: from access.maxClassification (NEVER change this value)
    - topK: 8
3.  Return ONLY what the tool returns - never add your own content\`,
    memory,
    tools: { vectorQueryTool }
    });`}
    </pre>

    </Box>
  <Typography sx={{ fontSize: '1rem', fontWeight: 'bold', mt: 3, mb: 2 }}>Real Tool Example: Vector Query Tool</Typography>
  <Box sx={{ bgcolor: 'background.surface', p: 3, borderRadius: 1, fontSize: '0.875rem', fontFamily: 'monospace', overflowX: 'auto', mb: 2 }}>
  <pre style={{ margin: 0, whiteSpace: 'pre-wrap' }}>
    {`import { createTool } from "@mastra/core/tools";

        import { z } from "zod";

export const vectorQueryTool = createTool({
  id: "vector-query",
  description: "PgVector query with allowTags + classification filter",
  inputSchema: z.object({
    question: z.string(),
    allowTags: z.array(z.string()),
    maxClassification: z.enum(["public","internal","confidential"]),
    topK: z.number()
  }),
  outputSchema: z.object({
    contexts: z.array(z.object({
      text: z.string(),
      docId: z.string(),
      versionId: z.string(),
      source: z.string(),
      score: z.number(),
      securityTags: z.array(z.string()),
      classification: z.enum(["public","internal","confidential"])
    }))
  }),
  execute: async ({ context, mastra }) => {
    // Real implementation with PgVector queries and security filtering
    // ... actual implementation code ...
  }
});`}
      </pre>
    </Box>
    <Typography sx={{ fontSize: '1rem', fontWeight: 'bold', mt: 3, mb: 2 }}>Agent Workflow Architecture</Typography>
    <Box sx={{ bgcolor: 'background.surface', p: 3, borderRadius: 1, border: '1px solid', borderColor: 'divider' }}>
      <Mermaid chart={`graph LR
        A[User Query] --> B[Access Control]
        B --> C[Identity Agent]
        C --> D[Policy Agent]
        D --> E[Retrieve Agent]
        E --> F[Rerank Agent]
        F --> G[Answerer Agent]
        G --> H[Verifier Agent]
        H --> I[Final Response]
        B --> J[403: Access Denied]
        E --> K[Research Agent]
        F --> L[Copywriter Agent]
        G --> M[Report Agent]
        classDef core fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
        classDef advanced fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
        classDef error fill:#ffebee,stroke:#c62828,stroke-width:2px
        class A,B,C,D,E,F,G,H,I core
        class K,L,M advanced
        class J error
        `} />

</Box>
    <Alert sx={{ mt: 2 }}>
      <Shield sx={{ fontSize: 16 }} />
      <AlertTitle>Security Integration</AlertTitle>
      <AlertDescription>
        All agents include security checks and access control. Secrets are managed via environment variables and never committed to code.
      </AlertDescription>
    </Alert>

  </TabsContent>

  <TabsContent value="storage">
    <Typography sx={{ fontSize: '1.125rem', fontWeight: 'bold', mb: 2 }}>Storage Architecture</Typography>
    <Typography sx={{ mb: 2 }}>Dual storage system optimized for different data types and access patterns.</Typography>
    <Box sx={{ display: 'grid', gridTemplateColumns: { xs: '1fr', md: 'repeat(2, 1fr)' }, gap: 3, mb: 3 }}>
      <Card variant="outlined">
        <CardHeader>
          <CardTitle sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
            <Database sx={{ fontSize: 20, color: 'primary.main' }} />
            PostgreSQL Storage
          </CardTitle>
        </CardHeader>
        <CardContent>
          <Box component="ul" sx={{ m: 0, pl: 2, '& li': { mb: 1, fontSize: '0.875rem', display: 'flex', alignItems: 'center' } }}>
            <li><CheckCircle sx={{ fontSize: 12, color: 'success.main', mr: 1 }} />Metadata and conversations</li>
            <li><CheckCircle sx={{ fontSize: 12, color: 'success.main', mr: 1 }} />Thread management</li>
            <li><CheckCircle sx={{ fontSize: 12, color: 'success.main', mr: 1 }} />User sessions</li>
            <li><CheckCircle sx={{ fontSize: 12, color: 'success.main', mr: 1 }} />Audit logs</li>
          </Box>
        </CardContent>
      </Card>
      <Card variant="outlined">
        <CardHeader>
          <CardTitle sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
            <FileText sx={{ fontSize: 20, color: 'secondary.main' }} />
            PgVector Database
          </CardTitle>
        </CardHeader>
        <CardContent>
          <Box component="ul" sx={{ m: 0, pl: 2, '& li': { mb: 1, fontSize: '0.875rem', display: 'flex', alignItems: 'center' } }}>
            <li><CheckCircle sx={{ fontSize: 12, color: 'success.main', mr: 1 }} />3072 embeddings</li>
            <li><CheckCircle sx={{ fontSize: 12, color: 'success.main', mr: 1 }} />Cosine similarity</li>
            <li><CheckCircle sx={{ fontSize: 12, color: 'success.main', mr: 1 }} />High-performance search</li>
            <li><CheckCircle sx={{ fontSize: 12, color: 'success.main', mr: 1 }} />Filtered retrieval</li>
          </Box>
        </CardContent>
      </Card>
    </Box>
    <Typography sx={{ fontSize: '1rem', fontWeight: 'bold', mt: 3, mb: 2 }}>Storage Flow</Typography>
    <Box sx={{ bgcolor: 'background.surface', p: 3, borderRadius: 1, border: '1px solid', borderColor: 'divider' }}>
      <Mermaid chart={`graph TD
        A[Document Input] --> B[Text Processing]
        B --> C[Embedding Generation]
        C --> D[PgVector Storage]
        C --> E[Metadata Storage]
        E --> F[PostgreSQL Database]
        D --> G[Vector Search]
        F --> H[Thread Retrieval]
        G --> I[Similarity Results]
        H --> J[Context Assembly]
        classDef process fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
        classDef storage fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
        classDef retrieval fill:#fff3e0,stroke:#e65100,stroke-width:2px
        class A,B,C process
        class D,E,F storage
        class G,H,I,J retrieval
`} />

</Box>

  </TabsContent>

  <TabsContent value="observability">
    <Typography sx={{ fontSize: '1.125rem', fontWeight: 'bold', mb: 2 }}>Observability & Monitoring</Typography>
    <Typography sx={{ mb: 2 }}>Comprehensive monitoring with structured logging, AI tracing, and performance metrics.</Typography>
    <Box sx={{ display: 'flex', flexDirection: 'column', gap: 3 }}>
      <Card variant="outlined">
        <CardHeader>
          <CardTitle>Logging & Tracing</CardTitle>
        </CardHeader>
        <CardContent>
          <Box component="ul" sx={{ m: 0, pl: 2, '& li': { mb: 1 } }}>
            <li><strong>Structured Logging:</strong> Pino logger with custom transports</li>
            <li><strong>AI Tracing:</strong> Langfuse integration for LLM observability</li>
            <li><strong>Performance Metrics:</strong> Request latency, token usage, error rates</li>
            <li><strong>Audit Trails:</strong> Complete user action history</li>
          </Box>
        </CardContent>
      </Card>
      <Alert>
        <Brain sx={{ fontSize: 16 }} />
        <AlertTitle>AI Model Monitoring</AlertTitle>
        <AlertDescription>
          Tracks Google Gemini 2.5 Flash usage, OpenAI GPT-4o-mini calls, and embedding performance across all agents.
        </AlertDescription>
      </Alert>
    </Box>

  </TabsContent>
</Tabs>
      <CardContent>
        The provided docker-compose uses <code>opensearchproject/opensearch:2.11.0</code> with HTTP/HTTPS ports and a default admin password. For production, secure the cluster and rotate passwords.
      </CardContent>
    </Card>
  </TabsContent>

  <TabsContent value="observability">
    <h3 className="text-lg font-semibold">Observability</h3>
    <p>Mastra services emit structured logs to <code>logs/mastra.log</code> and metrics to Prometheus-compatible endpoints. Configure dashboards in OpenSearch Dashboards or Grafana.</p>
  </TabsContent>
</Tabs>

<Separator sx={{ my: 3 }} />

## Quick Start

<Tabs defaultValue="setup" sx={{ mb: 3 }}>
  <TabsList>
    <TabsTrigger value="setup">Setup</TabsTrigger>
    <TabsTrigger value="query">Query Example</TabsTrigger>
    <TabsTrigger value="index">Indexing</TabsTrigger>
  </TabsList>

  <TabsContent value="setup">
    <Typography sx={{ fontSize: '1.125rem', fontWeight: 'bold', mb: 2 }}>Environment Setup</Typography>
    <Box sx={{ display: 'flex', flexDirection: 'column', gap: 3 }}>
      <Box>
        <Typography sx={{ fontWeight: 'bold', mb: 1 }}>1. Start Dependencies</Typography>
        <Box sx={{ bgcolor: 'background.surface', p: 2, borderRadius: 1, fontSize: '0.875rem', fontFamily: 'monospace' }}>
          <pre style={{ margin: 0, whiteSpace: 'pre-wrap' }}>
{`# Start PostgreSQL + PgVector database
docker run -d -p 5432:5432 \\
  -e POSTGRES_PASSWORD=password \\
  -e POSTGRES_DB=mastra \\
  postgres:15

# Enable PgVector extension

docker exec -it <container_id> psql -U postgres -d mastra -c "CREATE EXTENSION IF NOT EXISTS vector;"

# Start development environment

npm run dev`}

</pre>
</Box>
</Box>
      <Box>
        <Typography sx={{ fontWeight: 'bold', mb: 1 }}>2. Environment Variables</Typography>
        <Box sx={{ bgcolor: 'background.surface', p: 2, borderRadius: 1, fontSize: '0.875rem', fontFamily: 'monospace' }}>
          <pre style={{ margin: 0, whiteSpace: 'pre-wrap' }}>

{`# .env.local
MASTRA_BASE_URL=http://localhost:3001
OPENAI_API_KEY=your-key-here
GOOGLE_GENERATIVE_AI_API_KEY=your-gemini-key
DATABASE_URL=postgresql://postgres:password@localhost:5432/mastra
JWT_SECRET='dev-secret'
NODE_ENV='development'`}

</pre>
</Box>
</Box>
      <Box>
        <Typography sx={{ fontWeight: 'bold', mb: 1 }}>3. Available Models</Typography>
        <Box sx={{ display: 'grid', gridTemplateColumns: { xs: '1fr', md: 'repeat(2, 1fr)' }, gap: 3 }}>
          <Card variant="outlined">
            <CardHeader>
              <CardTitle sx={{ fontSize: '0.875rem' }}>Google Gemini</CardTitle>
            </CardHeader>
            <CardContent>
              <Box component="ul" sx={{ m: 0, pl: 2, '& li': { mb: 0.5, fontSize: '0.75rem' } }}>
                <li>• gemini-2.5-flash-lite (fast)</li>
                <li>• gemini-2.5-flash (balanced)</li>
                <li>• gemini-2.5-pro (advanced)</li>
              </Box>
            </CardContent>
          </Card>
          <Card variant="outlined">
            <CardHeader>
              <CardTitle sx={{ fontSize: '0.875rem' }}>OpenAI</CardTitle>
            </CardHeader>
            <CardContent>
              <Box component="ul" sx={{ m: 0, pl: 2, '& li': { mb: 0.5, fontSize: '0.75rem' } }}>
                <li>• gpt-4o-mini (fast, cheap)</li>
                <li>• gpt-4o (advanced)</li>
                <li>• text-embedding-3-small</li>
              </Box>
            </CardContent>
          </Card>
        </Box>
      </Box>
    </Box>

  </TabsContent>

  <TabsContent value="query">
    <Typography sx={{ fontSize: '1.125rem', fontWeight: 'bold', mb: 2 }}>Query the RAG System</Typography>
    <Box sx={{ bgcolor: 'background.surface', p: 2, borderRadius: 1, fontSize: '0.875rem', fontFamily: 'monospace', overflowX: 'auto' }}>
      <pre style={{ margin: 0, whiteSpace: 'pre-wrap' }}>
{`// Frontend query example
const response = await fetch('/api/mastra/query', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    query: "What are the security policies?",
    userId: "user123"
  })
})

const result = await response.json()
console.log(result.answer, result.sources)`}

</pre>
</Box>

  </TabsContent>

  <TabsContent value="index">
    <Typography sx={{ fontSize: '1.125rem', fontWeight: 'bold', mb: 2 }}>Index Documents</Typography>
    <Box sx={{ bgcolor: 'background.surface', p: 2, borderRadius: 1, fontSize: '0.875rem', fontFamily: 'monospace', overflowX: 'auto' }}>
      <pre style={{ margin: 0, whiteSpace: 'pre-wrap' }}>
{`// Index new documents
const response = await fetch('/api/mastra/index', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    documents: [
      {
        content: "Company policy text...",
        metadata: { source: "hr-policy.pdf" }
      }
    ]
  })
})`}
      </pre>
    </Box>
  </TabsContent>
</Tabs>

<Separator sx={{ my: 3 }} />

## API Reference (server routes)

<Card variant="outlined">
  <CardHeader>
    <CardTitle>Key Endpoints</CardTitle>
  </CardHeader>
  <CardContent>
    <Box sx={{ display: 'flex', flexDirection: 'column', gap: 3 }}>
      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
        <Badge variant="soft" color="secondary">POST</Badge>
        <Typography component="code" sx={{ fontSize: '0.875rem' }}>/api/mastra/query</Typography>
        <Typography level="body-sm" sx={{ color: 'text.tertiary' }}>— Ask the RAG system a question</Typography>
      </Box>
      <Box sx={{ ml: 3 }}>
        <Typography level="body-sm" sx={{ fontWeight: 'bold' }}>Request Body:</Typography>
        <Box sx={{ bgcolor: 'background.surface', p: 1, borderRadius: 1, fontSize: '0.75rem', fontFamily: 'monospace', mt: 0.5 }}>
          <pre style={{ margin: 0, whiteSpace: 'pre-wrap' }}>
{`{
  "query": "What is the company policy on remote work?",
  "userId": "user123",
  "sessionId": "session456"
}`}
          </pre>
        </Box>
        <Typography level="body-sm" sx={{ mt: 1 }}>Response: JSON with answer, sources, and confidence score</Typography>
      </Box>
      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
        <Badge variant="soft">GET</Badge>
        <Typography component="code" sx={{ fontSize: '0.875rem' }}>/api/mastra/status</Typography>
        <Typography level="body-sm" sx={{ color: 'text.tertiary' }}>— Health check</Typography>
      </Box>
      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
        <Badge variant="soft" color="danger">POST</Badge>
        <Typography component="code" sx={{ fontSize: '0.875rem' }}>/api/mastra/index</Typography>
        <Typography level="body-sm" sx={{ color: 'text.tertiary' }}>— Submit documents (protected)</Typography>
      </Box>
      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
        <Badge variant="soft" color="danger">POST</Badge>
        <Typography component="code" sx={{ fontSize: '0.875rem' }}>/api/mastra/agents/run</Typography>
        <Typography level="body-sm" sx={{ color: 'text.tertiary' }}>— Trigger agent workflows (admin-only)</Typography>
      </Box>
    </Box>

  </CardContent>
</Card>

<Separator sx={{ my: 3 }} />

## Authentication & Authorization

<Tabs defaultValue="auth" sx={{ mb: 3 }}>
  <TabsList>
    <TabsTrigger value="auth">Auth</TabsTrigger>
    <TabsTrigger value="rbac">RBAC</TabsTrigger>
    <TabsTrigger value="auditing">Auditing</TabsTrigger>
  </TabsList>

<TabsContent value="auth">
    <Typography>
        The app uses JWTs issued by the Mastra auth provider. Tokens are set in
        HttpOnly cookies by server-side proxy routes (see{' '}
        <Typography component="code" sx={{ fontSize: '0.875rem' }}>
            lib/mastra/mastra-client.ts
        </Typography>
        ). Scopes and claims control access to endpoints.
    </Typography>
</TabsContent>

<TabsContent value="rbac">
    <Typography sx={{ mb: 2 }}>Roles in the system:</Typography>
    <Box component="ul" sx={{ ml: 3, '& li': { mb: 1 } }}>
        <li>
            <strong>reader</strong> — Query-only access.
        </li>
        <li>
            <strong>editor</strong> — Can submit documents for indexing.
        </li>
        <li>
            <strong>admin</strong> — Manage agents and configuration.
        </li>
    </Box>
</TabsContent>

  <TabsContent value="auditing">
    <Typography>All agent runs and query responses are stored with provenance metadata. Configure retention and export via the Mastra server settings.</Typography>
  </TabsContent>
</Tabs>

<Separator sx={{ my: 3 }} />

## Deployment & Local Dev

<Tabs defaultValue="local" sx={{ mb: 3 }}>
  <TabsList>
    <TabsTrigger value="local">Local Dev</TabsTrigger>
    <TabsTrigger value="production">Production</TabsTrigger>
    <TabsTrigger value="troubleshooting">Troubleshooting</TabsTrigger>
  </TabsList>

  <TabsContent value="local">
    <Card variant="outlined">
      <CardHeader>
        <CardTitle>Local Development Setup</CardTitle>
      </CardHeader>
      <CardContent>
        <Box component="ol" sx={{ ml: 3, '& li': { mb: 1 } }}>
          <li><strong>Start PostgreSQL + PgVector:</strong> <Typography component="code" sx={{ fontSize: '0.875rem' }}>docker run -d -p 5432:5432 -e POSTGRES_PASSWORD=password postgres:15</Typography></li>
          <li><strong>Install Dependencies:</strong> <Typography component="code" sx={{ fontSize: '0.875rem' }}>npm install</Typography></li>
          <li><strong>Configure Environment:</strong> Copy <Typography component="code" sx={{ fontSize: '0.875rem' }}>.env.example</Typography> to <Typography component="code" sx={{ fontSize: '0.875rem' }}>.env</Typography></li>
          <li><strong>Start Development:</strong> <Typography component="code" sx={{ fontSize: '0.875rem' }}>npm run dev</Typography></li>
          <li><strong>Verify Health:</strong> Check <Typography component="code" sx={{ fontSize: '0.875rem' }}>http://localhost:3000/api/health</Typography></li>
        </Box>
        <Alert sx={{ mt: 2 }}>
          <FileText sx={{ fontSize: 16 }} />
          <AlertTitle>Development Commands</AlertTitle>
          <AlertDescription>
            Use <Typography component="code" sx={{ fontSize: '0.875rem' }}>npm run dev:mastra</Typography> to run Mastra in development mode, or <Typography component="code" sx={{ fontSize: '0.875rem' }}>npm run dev</Typography> for full stack.
          </AlertDescription>
        </Alert>
      </CardContent>
    </Card>

  </TabsContent>

  <TabsContent value="production">
    <Card variant="outlined">
      <CardHeader>
        <CardTitle>Production Deployment</CardTitle>
      </CardHeader>
      <CardContent>
        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 3 }}>
          <Box>
            <Typography sx={{ fontWeight: 'bold', mb: 1 }}>Infrastructure Requirements</Typography>
            <Box component="ul" sx={{ ml: 3, '& li': { mb: 0.5 } }}>
              <li><strong>PostgreSQL + PgVector Cluster:</strong> Managed PostgreSQL instance with PgVector extension</li>
              <li><strong>Database:</strong> PostgreSQL for metadata storage</li>
              <li><strong>AI Models:</strong> Google Gemini API key and/or OpenAI API key</li>
              <li><strong>Storage:</strong> File storage for logs and temporary data</li>
            </Box>
          </Box>
          <Box>
            <Typography sx={{ fontWeight: 'bold', mb: 1 }}>Environment Variables</Typography>
            <Box sx={{ bgcolor: 'background.surface', p: 2, borderRadius: 1, fontSize: '0.875rem', fontFamily: 'monospace' }}>
              <pre style={{ margin: 0, whiteSpace: 'pre-wrap' }}>

{`# Production Configuration
NODE_ENV=production
MASTRA_BASE_URL=https://your-domain.com
OPENAI_API_KEY=your-production-openai-key
GOOGLE_GENERATIVE_AI_API_KEY=your-production-gemini-key
DATABASE_URL=postgresql://user:password@your-postgres-host:5432/mastra
JWT_SECRET=your-secure-random-jwt-secret
LANGFUSE_PUBLIC_KEY=your-langfuse-key
LANGFUSE_SECRET_KEY=your-langfuse-secret`}

</pre>
</Box>
</Box>
          <Box>
            <Typography sx={{ fontWeight: 'bold', mb: 1 }}>Deployment Steps</Typography>
            <Box sx={{ bgcolor: 'background.surface', p: 2, borderRadius: 1, fontSize: '0.875rem', fontFamily: 'monospace' }}>
              <pre style={{ margin: 0, whiteSpace: 'pre-wrap' }}>

{`# Build the application
npm run build

# Start production server

npm start

# Or use PM2 for process management

npm install -g pm2
pm2 start npm --name "mastra-rag" -- start`}

</pre>
</Box>
</Box>
          <Box>
            <Typography sx={{ fontWeight: 'bold', mb: 1 }}>Monitoring Setup</Typography>
            <Box component="ul" sx={{ ml: 3, '& li': { mb: 0.5 } }}>
              <li><strong>Langfuse:</strong> AI model performance and tracing</li>
              <li><strong>Logs:</strong> Structured logging to <Typography component="code" sx={{ fontSize: '0.875rem' }}>logs/mastra.log</Typography></li>
              <li><strong>Health Checks:</strong> <Typography component="code" sx={{ fontSize: '0.875rem' }}>/api/health</Typography> endpoint</li>
              <li><strong>Metrics:</strong> Prometheus-compatible metrics available</li>
            </Box>
          </Box>
        </Box>
      </CardContent>
    </Card>

  </TabsContent>

  <TabsContent value="troubleshooting">
    <Card variant="outlined">
      <CardHeader>
        <CardTitle>Common Issues</CardTitle>
      </CardHeader>
      <CardContent>
        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 3 }}>
          <Alert color="warning">
            <FileText sx={{ fontSize: 16 }} />
            <AlertTitle>OpenSearch Connection Failed</AlertTitle>
            <AlertDescription>
              Ensure OpenSearch is running and accessible. Check <Typography component="code" sx={{ fontSize: '0.875rem' }}>docker ps</Typography> and network connectivity.
            </AlertDescription>
          </Alert>
          <Alert color="warning">
            <Code sx={{ fontSize: 16 }} />
            <AlertTitle>MDX Compilation Errors</AlertTitle>
            <AlertDescription>
              Check that all remark/rehype plugins are installed and properly configured in <Typography component="code" sx={{ fontSize: '0.875rem' }}>lib/mdx-plugins.ts</Typography>.
            </AlertDescription>
          </Alert>
        </Box>
      </CardContent>
    </Card>

  </TabsContent>
</Tabs>

<Separator sx={{ my: 3 }} />

## Example: Query endpoint (server-side)

<Card variant="outlined">
  <CardHeader>
    <CardTitle>Server route skeleton</CardTitle>
  </CardHeader>
  <CardContent>
    <Box sx={{ bgcolor: 'grey.900', color: 'grey.50', p: 2, borderRadius: 1, fontFamily: 'monospace', fontSize: '0.875rem' }}>
      <pre style={{ margin: 0, whiteSpace: 'pre-wrap' }}>
{`// app/api/mastra/query/route.ts
import { NextResponse } from 'next/server'
import { proxyToMastra } from '@/lib/mastra/mastra-client'

export async function POST(req: Request) {
  const body = await req.json()
  // validate + enforce RBAC here
  const res = await proxyToMastra('/query', { method: 'POST', body })
  return NextResponse.json(await res.json())
}
`}
      </pre>
    </Box>
  </CardContent>
</Card>

<Separator sx={{ my: 3 }} />

## Security Checklist

<Box component="ul" sx={{ ml: 3, '& li': { mb: 1 } }}>
    <li>Require TLS for all Mastra endpoints.</li>
    <li>Rotate the OpenSearch password from the docker compose example.</li>
    <li>Use least-privilege for agents and storage credentials.</li>
    <li>
        Enable audit logging and store logs in a write-once medium if required
        by policy.
    </li>
</Box>

<Separator sx={{ my: 3 }} />

## Next steps & follow-ups

<Card variant="outlined">
  <CardHeader>
    <CardTitle>What's Next?</CardTitle>
  </CardHeader>
  <CardContent>
    <Box sx={{ display: 'flex', flexDirection: 'column', gap: 3 }}>
      <Box>
        <Typography sx={{ fontWeight: 'bold', mb: 1 }}>Related Documentation</Typography>
        <Box component="ul" sx={{ ml: 3, '& li': { mb: 0.5 } }}>
          <li><Typography component="a" href="/docs/api-reference" sx={{ color: 'primary.main', textDecoration: 'none', '&:hover': { textDecoration: 'underline' } }}>API Reference</Typography> — Complete endpoint documentation</li>
          <li><Typography component="a" href="/docs/security" sx={{ color: 'primary.main', textDecoration: 'none', '&:hover': { textDecoration: 'underline' } }}>Security Guide</Typography> — Advanced security configurations</li>
          <li><Typography component="a" href="/docs/architecture" sx={{ color: 'primary.main', textDecoration: 'none', '&:hover': { textDecoration: 'underline' } }}>Architecture Deep Dive</Typography> — Technical implementation details</li>
        </Box>
      </Box>
      <Box>
        <Typography sx={{ fontWeight: 'bold', mb: 1 }}>Development Tasks</Typography>
        <Box component="ul" sx={{ ml: 3, '& li': { mb: 0.5 } }}>
          <li>Implement server routes for all Mastra endpoints</li>
          <li>Add comprehensive error handling and logging</li>
          <li>Create admin UI for agent management</li>
          <li>Set up monitoring and alerting</li>
        </Box>
      </Box>
    </Box>

  </CardContent>
</Card>

<Box
    sx={{
        mt: 3,
        p: 3,
        bgcolor: 'primary.softBg',
        borderRadius: 1,
        border: '1px solid',
        borderColor: 'primary.outlinedBorder',
    }}
>
    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5, mb: 1 }}>
        <FileText sx={{ fontSize: 20, color: 'primary.main' }} />
        <Typography sx={{ fontWeight: 'bold', color: 'primary.main' }}>
            Ready to Get Started?
        </Typography>
    </Box>
    <Typography sx={{ color: 'primary.main', mb: 2 }}>
        Follow the Quick Start guide above to set up your development
        environment and start building with Mastra.
    </Typography>
    <Button variant="solid" sx={{ bgcolor: 'primary.main' }}>
        Start Development
    </Button>
</Box>
